docker run -it --rm ubuntu bash
root@fa82673fd31f:/# apt-get update                                                                                                                                                       Get:1 http://security.ubuntu.com/ubuntu noble-security InRelease [126 kB]                                                                                                                 Get:2 http://archive.ubuntu.com/ubuntu noble InRelease [256 kB]                                                                                                                           Get:3 http://security.ubuntu.com/ubuntu noble-security/restricted amd64 Packages [1318 kB]                                                                                                Get:4 http://archive.ubuntu.com/ubuntu noble-updates InRelease [126 kB]                                                                                                                   Get:5 http://archive.ubuntu.com/ubuntu noble-backports InRelease [126 kB]                                                                                                                 Get:6 http://archive.ubuntu.com/ubuntu noble/multiverse amd64 Packages [331 kB]                                                                                                           Get:7 http://security.ubuntu.com/ubuntu noble-security/main amd64 Packages [1033 kB]                                                                                                      Get:8 http://archive.ubuntu.com/ubuntu noble/main amd64 Packages [1808 kB]
…
Fetched 29.9 MB in 3s (8654 kB/s)                                                                                                                                                         Reading package lists... Done  

Как мы видим, доступ есть.

Сначала я наивно попытался изменить правила IPTABLES, но быстро понял, что ни IPTABLES, ни ip, никаких подобных команд в контейнере нет.

Далее я попытался удалить /etc/resolv.conf, который определяет параметры разрешения доменных имен.

root@fa82673fd31f:/# rm -rf /etc/resolv.conf                                                                                                                                              rm: cannot remove '/etc/resolv.conf': Device or resource busy

Не удалось удалить, но получилось перезаписать (сделать пустым)

root@fa82673fd31f:/# echo > /etc/resolv.conf

После чего команда apt-get update перестала работать:

root@fa82673fd31f:/# apt-get update                                                                                                                                                       Ign:1 http://archive.ubuntu.com/ubuntu noble InRelease                                                                                                                                    Ign:2 http://archive.ubuntu.com/ubuntu noble-updates InRelease                                                                                                                            Ign:3 http://archive.ubuntu.com/ubuntu noble-backports InRelease                                                                                                                          Ign:4 http://security.ubuntu.com/ubuntu noble-security InRelease                                                                                                                          Ign:1 http://archive.ubuntu.com/ubuntu noble InRelease
…
Err:1 http://archive.ubuntu.com/ubuntu noble InRelease                                                                                                                                      Temporary failure resolving 'archive.ubuntu.com'                                                                                                                                        Err:4 http://security.ubuntu.com/ubuntu noble-security InRelease                                                                                                                            Temporary failure resolving 'security.ubuntu.com'                                                                                                                                       Err:2 http://archive.ubuntu.com/ubuntu noble-updates InRelease                                                                                                                              Temporary failure resolving 'archive.ubuntu.com'                                                                                                                                        Err:3 http://archive.ubuntu.com/ubuntu noble-backports InRelease                                                                                                                            Temporary failure resolving 'archive.ubuntu.com'                                                                                                                                        Reading package lists... Done                                                                                                                                                             W: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/noble/InRelease  Temporary failure resolving 'archive.ubuntu.com'                                                               W: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/noble-updates/InRelease  Temporary failure resolving 'archive.ubuntu.com'                                                       W: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/noble-backports/InRelease  Temporary failure resolving 'archive.ubuntu.com'                                                     W: Failed to fetch http://security.ubuntu.com/ubuntu/dists/noble-security/InRelease  Temporary failure resolving 'security.ubuntu.com'                                                    W: Some index files failed to download. They have been ignored, or old ones used instead.

Важное уточнение: я положил DNS, доступ по доменным именам и правда не работает. Однако доступ по внешним IP-адресам все ещё возможен.




